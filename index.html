<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Speech with Speed Control and Pause</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        button {
            width: 100px; /* Gomb szélessége */
            height: 40px; /* Gomb magassága */
            border-radius: 5px;
            border: 2px solid #000;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button#start-btn {
            background-color: lightcyan; /* Alap háttérszín */
            color: white; /* Betűszín */
        }
        button#start-btn.active {
            background-color: #000; /* Aktív háttérszín */
            color: #fff; /* Aktív betűszín */
        }
        button#stop-btn {
            background-color: lightcyan; /* Alap háttérszín */
            color: white; /* Betűszín */
        }
        button#stop-btn.active {
            background-color: #000; /* Aktív háttérszín */
            color: #fff; /* Aktív betűszín */
        }
        button.active {
            background-color: #000;
            color: #fff;
        }
        button.inactive {
            background-color: #fff;
            color: #000;
        }
        .text-input-container {
            display: flex;
            align-items: center;
            width: 85%; /* A teljes szélesség 85%-a */
            margin: 0 auto; /* Középre igazítás */
        }
        textarea {
            width: calc(100% - 50px); /* Teljes szélesség minusz a clear gomb szélessége */
            height: 100px;
            border-radius: 15px;
            background-color: lightgrey;
            padding: 10px;
            box-sizing: border-box; /* Minden méretezés a padding-ot is tartalmazza */
        }
        button#clear-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #000;
            background-color: #fff;
            color: #000;
            cursor: pointer;
            font-size: 20px;
            margin-left: -30px; /* A gomb közel kerül a szövegdobozhoz */
            padding: 0;
            line-height: 1;
        }
        .speed-control {
            margin: 20px;
        }
        .button-container {
            display: inline-block;
            text-align: center;
            position: relative;
        }
        .button-container span {
            display: block;
            font-size: smaller;
            position: absolute;
            bottom: -30px; /* A gomb alatt, állítsd be az igényed szerint */
            left: 50%;
            transform: translateX(-50%);
            margin-top: 5px;
        }
        .text-input-container {
            display: inline-flex;
            align-items: center;
            margin-bottom: 10px; /* Távolság az alatta lévő elemekhez */
        }
    </style>
</head>
<body>
    <h1>Text to Speech with Speed Control and Pause</h1>
    
    <div class="text-input-container">
        <textarea id="text-input" placeholder="Enter text here..."></textarea>
        <button id="clear-btn" onclick="document.getElementById('text-input').value=''">×</button>
    </div>
    
    <!-- Speed control dropdown -->
    <div class="speed-control">
        <label for="speed-select">Select Speed:</label>
        <select id="speed-select">
            <option value="0.2">0.2x</option>
            <option value="0.4">0.4x</option>
            <option value="0.6" selected>0.6x</option>
            <option value="0.8">0.8x</option>
            <option value="1">1x</option>
            <option value="1.25">1.25x</option>
            <option value="1.5">1.5x</option>
        </select>
    </div>

    <div class="button-container">
        <button id="start-btn" onclick="startSpeech()">I◁</button>
        <span> </span>
    </div>

    <div class="button-container">
        <button id="pause-btn" onclick="pauseSpeech()">&#10074;&#10074;</button>
        <button id="resume-btn" onclick="resumeSpeech()">&#9654;</button>
    </div>

    <button id="stop-btn" onclick="stopSpeech()">■</button> <!-- Stop gomb -->
    <span> </span>
    
    <div id="current-sentence" style="font-size: 50px; margin-top: 20px;"></div>

    <script>
        let utterance = null; // Global variable for the SpeechSynthesisUtterance
        let sentences = []; // Array to hold sentences
        let currentIndex = 0; // Index for tracking current sentence
        let isSpeaking = false; // Track if speech is currently active
        let isPaused = false; // Track if speech is paused

        // Function to set button states
        function changeButtonState(buttonId) {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.classList.remove('active');
                button.classList.add('inactive');
            });
            if (buttonId) {
                document.getElementById(buttonId).classList.add('active');
                document.getElementById(buttonId).classList.remove('inactive');
            }
        }

        function startSpeech() {
            if (window.speechSynthesis.speaking || window.speechSynthesis.paused) {
                window.speechSynthesis.cancel();
            }

            const text = document.getElementById('text-input').value;
            if (!text.trim()) {
                return;
            }

            sentences = text.match(/[^.!?]*[.!?]/g) || [];
            currentIndex = 0;
            isSpeaking = true;
            isPaused = false;

            changeButtonState('start-btn'); // Aktív gomb

            function speakNextSentence() {
                if (currentIndex < sentences.length) {
                    const sentence = sentences[currentIndex];
                    document.getElementById('current-sentence').innerText = sentence.trim();

                    // 0.2 mp várakozás előtt kezdje el a felolvasást
                    setTimeout(() => {
                        utterance = new SpeechSynthesisUtterance(sentence);

                        const rate = document.getElementById('speed-select').value;
                        utterance.rate = parseFloat(rate);
                        utterance.lang = 'en-US';
                        utterance.pitch = 1;

                        window.speechSynthesis.speak(utterance);

                        utterance.onend = function() {
                            currentIndex++;
                            setTimeout(speakNextSentence, 200);
                        };
                    }, 200); // 0.2 mp várakozás
                } else {
                    isSpeaking = false;
                    changeButtonState(''); // Gomb állapot visszaállítása
                }
            }

            speakNextSentence();
        }

        function pauseSpeech() {
            if (window.speechSynthesis.speaking) {
                // Pause the speech
                window.speechSynthesis.pause();
                isSpeaking = false;
                isPaused = true;
                changeButtonState('pause-btn'); // Aktív gomb
                changeButtonState('stop-btn'); // Stop gomb deaktiválása
            }
        }

        function resumeSpeech() {
            if (isPaused) {
                if (!window.speechSynthesis.speaking && !window.speechSynthesis.paused) {
                    // Start speech from beginning if speech is not active
                    startSpeech();
                } else if (window.speechSynthesis.paused) {
                    // Resume the speech if it is paused
                    window.speechSynthesis.resume();
                    isSpeaking = true;
                    isPaused = false;
                    changeButtonState('resume-btn'); // Aktív gomb
                    changeButtonState('stop-btn'); // Stop gomb deaktiválása
                }
            }
        }

        function stopSpeech() {
            if (window.speechSynthesis.speaking || window.speechSynthesis.paused) {
                window.speechSynthesis.cancel();
                isSpeaking = false;
                isPaused = false;
                changeButtonState(''); // Minden gomb deaktiválása
                changeButtonState('stop-btn'); // Stop gomb aktiválása
            }
        }

        // Load placeholder text if available
        document.getElementById('text-input').value = localStorage.getItem('textInput') || '';

        // Set Start button as active initially
        changeButtonState('start-btn');

        // Save text to localStorage on page unload
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('textInput', document.getElementById('text-input').value);
        });
    </script>
</body>
</html>
