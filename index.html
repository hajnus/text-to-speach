<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Speech with Speed Control and Pause</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 20px;
    }
    button {
        width: 100px; /* Gomb szélessége */
        height: 40px; /* Gomb magassága */
        border-radius: 5px;
        border: 2px solid #000;
        background-color: #fff;
        color: #000;
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
    }
    button.active {
        background-color: #000;
        color: #fff;
    }
    textarea {
        width: 85vw; /* A szövegdoboz szélessége az oldal szélességének 85%-a */
        height: 100px;
        border-radius: 15px;
        background-color: lightgrey;
        padding: 10px;
        box-sizing: border-box; /* Minden méretezés a padding-ot is tartalmazza */
    }
    button#clear-btn {
        width: 40px; /* Gomb szélessége */
        height: 40px; /* Gomb magassága */
        border-radius: 50%; /* Kerek gomb */
        border: 2px solid #000;
        background-color: #fff;
        color: #000;
        cursor: pointer;
        font-size: 20px;
        margin-left: -30px; /* Közel helyezkedik el a szövegdobozhoz */
        padding: 0;
        line-height: 1;
    }
    .speed-control {
        margin: 20px;
    }
    .button-container {
        display: inline-block;
        text-align: center;
        position: relative;
    }
    .button-container span {
        display: block;
        font-size: smaller;
        position: absolute;
        bottom: -30px; /* A gomb alatt, állítsd be az igényed szerint */
        left: 50%;
        transform: translateX(-50%);
        margin-top: 5px;
    }
    .text-input-container {
        display: inline-flex;
        align-items: center;
        margin-bottom: 10px; /* Távolság az alatta lévő elemekhez */
    }

    /* Stop gomb stílusok */
    button#stop-btn {
        background-color: cyan; /* Alap háttérszín */
        color: white; /* Betűszín */
    }
    button#stop-btn.active {
        background-color: black; /* Aktív háttérszín */
        color: white; /* Aktív betűszín */
    }
    button#stop-btn.inactive {
        background-color: white; /* Inaktív háttérszín, ha másik gomb aktiválva van */
        color: black; /* Inaktív betűszín, ha másik gomb aktiválva van */
    }
</style>
</head>
<body>
    <h1>Text to Speech with Speed Control and Pause</h1>
    
    <div class="text-input-container">
        <textarea id="text-input" placeholder="Enter text here..."></textarea>
        <button id="clear-btn" onclick="document.getElementById('text-input').value=''">×</button>
    </div>
    
    <!-- Speed control dropdown -->
    <div class="speed-control">
        <label for="speed-select">Select Speed:</label>
        <select id="speed-select">
            <option value="0.2">0.5x</option>
            <option value="0.4">0.75x</option>
            <option value="0.6" selected>1x</option>
            <option value="0.8">1.25x</option>
            <option value="1">1.5x</option>
            <option value="1.25">1.75x</option>
            <option value="1.5">2x</option>
        </select>
    </div>

    <!-- Voice selection dropdown -->
    <div class="speed-control">
        <label for="voice-select">Select Voice:</label>
        <select id="voice-select">
            <!-- Options will be populated by JavaScript -->
        </select>
    </div>

    <div class="button-container">
        <button id="start-btn" onclick="startSpeech()">I◁</button>
        <span> </span>
    </div>

    <div class="button-container">
        <button id="pause-btn" onclick="pauseSpeech()">&#10074;&#10074;
            <span> </span>
        </button>
        <button id="resume-btn" onclick="resumeSpeech()">&#9654;
            <span> </span>
        </button>
    </div>

    <button id="stop-btn" onclick="stopSpeech()">■</button> <!-- Stop gomb -->
    <span> </span>
    
    <div id="current-sentence" style="font-size: 50px; margin-top: 20px;"></div>

    <script>
        let utterance = null; // Global variable for the SpeechSynthesisUtterance
        let sentences = []; // Array to hold sentences
        let currentIndex = 0; // Index for tracking current sentence
        let isSpeaking = false; // Track if speech is currently active
        let isPaused = false; // Track if speech is paused

        // Function to set button states
        function changeButtonState(buttonId) {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.classList.remove('active');
                button.classList.add('inactive');
            });
            if (buttonId) {
                const button = document.getElementById(buttonId);
                button.classList.add('active');
                button.classList.remove('inactive');
            }
        }

        function populateVoiceOptions() {
            const voiceSelect = document.getElementById('voice-select');
            const voices = window.speechSynthesis.getVoices();

            voiceSelect.innerHTML = ''; // Clear existing options

            voices.forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = voice.name || `Voice ${index + 1}`;
                voiceSelect.appendChild(option);
            });
        }

        function startSpeech() {
            if (window.speechSynthesis.speaking || window.speechSynthesis.paused) {
                window.speechSynthesis.cancel();
            }

            const text = document.getElementById('text-input').value;
            if (!text.trim()) {
                return;
            }

            sentences = text.match(/[^.!?]*[.!?]/g) || [];
            currentIndex = 0;
            isSpeaking = true;
            isPaused = false;

            changeButtonState('start-btn'); // Aktív gomb

            function speakNextSentence() {
                if (currentIndex < sentences.length) {
                    const sentence = sentences[currentIndex];
                    document.getElementById('current-sentence').innerText = sentence.trim();

                    // 0.2 mp várakozás előtt kezdje el a felolvasást
                    setTimeout(() => {
                        utterance = new SpeechSynthesisUtterance(sentence);

                        const rate = document.getElementById('speed-select').value;
                        utterance.rate = parseFloat(rate);
                        utterance.lang = 'en-US';
                        utterance.pitch = 1;

                        const selectedVoiceIndex = document.getElementById('voice-select').value;
                        const voices = window.speechSynthesis.getVoices();
                        if (voices[selectedVoiceIndex]) {
                            utterance.voice = voices[selectedVoiceIndex];
                        }

                        window.speechSynthesis.speak(utterance);

                        utterance.onend = function() {
                            currentIndex++;
                            setTimeout(speakNextSentence, 200);
                        };
                    }, 200); // 0.2 mp várakozás
                } else {
                    isSpeaking = false;
                    changeButtonState(''); // Gomb állapot visszaállítása
                }
            }

            speakNextSentence();
        }

        function pauseSpeech() {
            if (window.speechSynthesis.speaking) {
                // Pause the speech
                window.speechSynthesis.pause();
                isSpeaking = false;
                isPaused = true;
                changeButtonState('pause-btn'); // Aktív gomb
            }
        }

        function resumeSpeech() {
            if (isPaused) {
                if (!window.speechSynthesis.speaking && !window.speechSynthesis.paused) {
                    // Start speech from beginning if speech is not active
                    startSpeech();
                } else if (window.speechSynthesis.paused) {
                    // Resume the speech if it is paused
                    window.speechSynthesis.resume();
                    isSpeaking = true;
                    isPaused = false;
                    changeButtonState('resume-btn'); // Aktív gomb
                }
            }
        }

        function stopSpeech() {
            if (window.speechSynthesis.speaking || window.speechSynthesis.paused) {
                window.speechSynthesis.cancel();
                isSpeaking = false;
                isPaused = false;
                changeButtonState(''); // Minden gomb deaktiválása
            }
        }

        // Load placeholder text if available
        document.getElementById('text-input').value = localStorage.getItem('textInput') || '';

        // Set Start button as active initially
        changeButtonState('start-btn');

        // Populate voice options when voices are loaded
        window.speechSynthesis.onvoiceschanged = populateVoiceOptions;

        // Save text to localStorage on page unload
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('textInput', document.getElementById('text-input').value);
        });
    </script>
</body>
</html>
